### 通过CPU主频，理解"性能"究竟是什么？



**什么是性能？时间的倒数**

​		第一个是**响应时间**或者叫执行时间，第二个是**吞吐率**或者带宽，服务器使用的网络带宽，通常就是一个吞吐率性能指标。响应时间指的就是，我们执行一个程序，到底需要花多少时间。吞吐率是指我们在一定的时间范围内，到底能处理多少事情。这里的事情，在计算机里就是处理的数据或者执行的程序指令。

**计算机的计时单位：CPU时钟**

time命令  

JackieLindeMacBook-Pro:WorkPlace jackie$ time

real	0m0.005s（Wall Clock Time，也就是运行程序整个过程中流逝掉的时间）

user	0m0.000s（CPU在运行你的程序，在用户态运行指令的时间）

sys	0m0.000s（CPU在运行你的程序，在操作系统内核里运行指令的时间）

而**程序实际花费的CPU执行时间（CPU Time)，就是user time+sys time**

time seq 1000000 | wc -l

JackieLindeMacBook-Pro:WorkPlace jackie$ time seq 1000000 | wc -l

 1000000

real	0m0.222s

user	0m0.217s

sys	0m0.012s

多核的CPU,可能出现user+sys 大于 real  ,seq和wc命令会分配到两个cpu上面，user和sys是两个cpu时间相加的，而real只是现实时钟里走过的时间，极端情况下user+sys可以达到real的两倍

<img src="../0b340db019d7e389a2bde4c237ee4700.jpg">



####		程序的CPU执行时间 = CPU时钟周期数 * 时钟周期时间

**CPU的主频**：Intel Core-i7-7700HQ 2.8GHz。  2.8GHz就是电脑的主频（Frequency/Clock Rate）。

这个2.8GHz，我们可以粗浅的认为，CPU在1秒时间内，可以执行的简单指令数量是2.8G条，如果想要更准确一点的描述，这个2.8GHz就代表，我们CPU的一个”钟表“能够识别出来的最小的时间间隔。

在CPU内部，和我们电子石英表类似，有一个晶体振荡器，简称为晶振。我们把晶振当成CPU内部的电子表来使用。晶振带来的每一次”滴答“，就是**时钟周期时间**。在2.8GHz的CPU上，这个时钟周期时间，就是1/2.8G。我们的CPU就是按照这个”时钟“提示的时间来进行自己的操作。主频越高，意味着这个表走到越快，我们的CPU也就”被逼着“走的越快。

**超频**：其实就相当于把买回来的CPU内部的钟给调快了，于是CPU的计算跟着这个时钟的节奏，也就自然变得快了。

CPU时钟周期数： 可以分解为“指令数 * **每条指令的平均时钟周期数**（Cycles Per Instruction，简称CPI）”

不同的指令需要的Cycles是不同的，加法和乘法都对应着一条CPU指令，但是乘法需要的Cycles就比加法要多，自然也就慢。所以我们的程序的CPU执行时间就可以编程这样三个部分的乘积。

####		程序的CPU执行时间 = 指令数 * CPI * Clock Cycle Time(时钟周期时间)

解决性能问题，其实主要就是优化这三者。

1.时钟周期时间，就是计算机主频。

2.每条指令的平均时钟周期数CPI，就是一条指令到底需要多少的CPU Cycle。现代的CPU通过流水线技术（Pipeline），让一条指令需要的CPU Cycle尽可能的少。

3.指令数，代表我们的程序到底需要多少条指令，用哪些指令。



如果把自己想象成CPU，主频像是打字速度，CPI相当于写程序的时候，熟悉各种快捷键，越是打同样的内容，需要敲击键盘的次数就越少。指令数相当于你的程序设计的够合理，同样的程序要写的代码行数就越少。

















